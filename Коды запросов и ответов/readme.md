## Полезные ссылки

[Статья Хабр счетчик Меркурий 203.2Т по RS-485](https://habr.com/ru/post/418209/)

[Протокол счетчиков Меркурий 230. Описание основных команд. Поддержка Инктекс](http://incotex-support.blogspot.com/2016/05/230.html)

[On-line CRC calculation](https://www.lammertbies.nl/comm/info/crc-calculation#intr)

## Формирование кода запроса и ответа

Каждый запрос и ответ начинаются с байта сетевого адреса, и заканчиваются двумя байта-
ми контрольной суммы CRC.

Формат запроса: `ADDR-CMD-CRC`

Формат ответа: `ADDR-CMD-DATA-CRC`

## Информация по подключению

Подключение к счетчику для снятия кодов команд осуществляется с использованием ПО TestALL с настройками:

- Тип Соединения = RS232;
- Время ожидания = 1500;
- Пауза перед запросом = 50;
- Повторные запросы = 3;
- Номер порта = 2;
- Скорость = 9600;
- Стоп биты = 1;
- Чётность = None;
- Биты данных = 8;
- Оптоголовка = False;
- Чтение текущих с прибора: Меркурий-230 168 
- Чтение параметров: EA_sum+; 

## Чтение параметра "номер-счетчика"

```
Отправлено: [11 байтов]
A8 01 01 01 01 01 01 01 01 E8 46                                       ..........F

Получено: [4 байта] [+00:090]
A8 00 7E 70                                                                    ..~p

Отправлено: [5 байтов]
A8 08 00 F7 E0                                                                .....

Получено: [10 байтов] [+00:098]
A8 23 2B 15 44 01 08 12 90 32                                            .#+.D....2

```

### Расшифровка первого запроса и ответа

Судя по всему это формат подключения к счетчику. При считывании одного параметра пара запрос/ответ неизменна.

`A8 01 01 01 01 01 01 01 01 E8 46`  - неизменно

`A8 00 7E 70` - неизменно

При считывании группы параметров пара запрос/ответ может отличаться.

### Расшифровка основного запроса

```
A8 08 00 F7 E0 
```

`A8` - адрес счетчика 168

`08` - неизменно

`00` - код функции для запроса номера счетчика (0h)

`F7 E0` - рассчитанный CRC

### Расшифровка основного  ответа

```
A8 23 2B 15 44 01 08 12 90 32
```

`A8` - адрес счетчика 168

`23 2B 15 44` - серийный номер

`01 08 12` - дата изготовления

`90 32` - CRC

Пример чтения в п. 2.3.1 стр. 46.

Примечание: при отправке команды, например `A8 08 00 F7 E0` байты `F7 E0` - CRC высчитываются мной на основании байтов `A8 08 00` и отправляются на счетчик, который в свою очередь сам вычисляет контрольную сумму CRC на основании байтов `A8 08 00` и сравнивает с высчитанной мной.

